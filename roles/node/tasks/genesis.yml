---
# Genesis Download Tasks
# Always downloads the network genesis, overwriting the placeholder from `init`

- name: Download genesis file
  ansible.builtin.get_url:
    url: "{{ node_genesis_url }}"
    dest: "{{ node_daemon_home }}/config/genesis.json"
    owner: "{{ node_daemon_user }}"
    group: "{{ node_daemon_group }}"
    mode: "0644"
    force: true
  become: true

- name: Verify genesis file
  ansible.builtin.command: >
    {{ node_daemon_home }}/cosmovisor/genesis/bin/{{ node_daemon_name }} genesis validate
    --home {{ node_daemon_home }}
  become: true
  become_user: "{{ node_daemon_user }}"
  register: node_genesis_validate
  changed_when: false
  failed_when: false

- name: Display genesis validation result
  ansible.builtin.debug:
    msg: "Genesis validation: {{ 'PASSED' if node_genesis_validate.rc == 0 else 'FAILED - ' + node_genesis_validate.stderr }}"
